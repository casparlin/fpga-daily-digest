<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Caspar's AI æ¯æ—¥ç²¾é€‰</title>
  <script type="module" src="https://cdn.jsdelivr.net/gh/zerodevx/zero-md@2/dist/zero-md.min.js"></script>
  <style>
    body { max-width: 800px; margin: 0 auto; padding: 20px; background: #f4f5f7; font-family: sans-serif; }
    .header { background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    .header h2 { margin: 0 0 15px 0; color: #333; }
    .nav-group { display: flex; justify-content: center; gap: 10px; }
    input[type="date"] { padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px; }
    button { padding: 8px 15px; border: 1px solid #ddd; background: #fafafa; border-radius: 4px; cursor: pointer; }
    zero-md { display: none; background: white; padding: 30px; border-radius: 8px; }
    .error-msg { display: none; text-align: center; padding: 40px; color: #888; }
  </style>
</head>
<body>

  <div class="header">
    <h2>ğŸ“° AI æ¯æ—¥æŠ€æœ¯ç²¾é€‰</h2>
    <div class="nav-group">
      <button id="prev-btn">â†</button>
      <input type="date" id="history-date">
      <button id="next-btn">â†’</button>
    </div>
  </div>

  <div id="error-msg" class="error-msg">è¯¥æ—¥æœŸæ²¡æœ‰æ—¥æŠ¥</div>
  <zero-md id="md-viewer"></zero-md>

  <script>
    const dateInput = document.getElementById('history-date');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    const mdViewer = document.getElementById('md-viewer');
    const errorMsg = document.getElementById('error-msg');

    function getLocalDateString(dateObj) {
      const offset = dateObj.getTimezoneOffset() * 60000;
      return new Date(dateObj.getTime() - offset).toISOString().split('T')[0];
    }

    const localTodayStr = getLocalDateString(new Date());
    dateInput.max = localTodayStr;
    dateInput.value = localTodayStr;

    async function loadDigest(dateStr) {
      if (!dateStr) return;
      nextBtn.disabled = (dateStr >= localTodayStr);

      let targetFile = 'digest.md';
      if (dateStr !== localTodayStr) {
        targetFile = `archives/digest-${dateStr.replace(/-/g, '')}.md`;
      }

      try {
        const res = await fetch(targetFile, { method: 'HEAD' });
        if (res.ok) {
          errorMsg.style.display = 'none';
          mdViewer.style.display = 'block';
          mdViewer.setAttribute('src', targetFile);
        } else {
          // å®¹é”™ï¼šå¦‚æœä»Šå¤©æ˜¯æœ€æ–°ï¼Œä½†æ ¹ç›®å½•æ²¡æœ‰ï¼Œå°è¯•å» archives æ‰¾
          if (dateStr === localTodayStr) {
            const fallback = `archives/digest-${localTodayStr.replace(/-/g, '')}.md`;
            const fallbackRes = await fetch(fallback, { method: 'HEAD' });
            if (fallbackRes.ok) {
              errorMsg.style.display = 'none';
              mdViewer.style.display = 'block';
              mdViewer.setAttribute('src', fallback);
              return;
            }
          }
          mdViewer.style.display = 'none';
          errorMsg.style.display = 'block';
        }
      } catch (e) {
        mdViewer.style.display = 'none';
        errorMsg.style.display = 'block';
      }
    }

    dateInput.addEventListener('change', e => loadDigest(e.target.value));
    prevBtn.addEventListener('click', () => {
      let d = new Date(dateInput.value); d.setDate(d.getDate() - 1);
      dateInput.value = getLocalDateString(d); loadDigest(dateInput.value);
    });
    nextBtn.addEventListener('click', () => {
      let d = new Date(dateInput.value); d.setDate(d.getDate() + 1);
      dateInput.value = getLocalDateString(d); loadDigest(dateInput.value);
    });

    loadDigest(localTodayStr);
  </script>
</body>
</html>
